---
platform: linux

image_resource:
  type: docker-image
  source:
    repository: google/cloud-sdk
    tag: 272.0.0-alpine

inputs:
- name: results

params:
  GOOGLE_CREDENTIALS:

run:
  path: bash
  args:
  - -ec
  - |-
    gcloud auth activate-service-account --key-file=<(echo "$GOOGLE_CREDENTIALS")
    gsutil \
      -m \
      -h "Cache-Control:no-cache,max-age=0" \
      rsync \
      -a public-read \
      -d \
      -r \
      ./results/webreports/ \
      gs://stress-tests.devboclips.net
